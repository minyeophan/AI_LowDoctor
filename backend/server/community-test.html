<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>JWT ì»¤ë®¤ë‹ˆí‹° + íŒŒì¼ ì—…ë¡œë“œ + ëŒ“ê¸€ ì¢‹ì•„ìš”/ì •ë ¬</title>
  <style>
    body { font-family: sans-serif; }
    h1, h2, h3 { margin-top: 1.2rem; }
    form { margin-bottom: 1rem; }
    textarea { font-family: inherit; }
    .comment-item { margin-bottom: 0.4rem; }
    .comment-actions button { margin-right: 4px; }
    .indent-1 { margin-left: 20px; }
    .indent-2 { margin-left: 40px; }
    .indent-3 { margin-left: 60px; }
  </style>
</head>
<body>

  <h1>ğŸ—£ JWT ì»¤ë®¤ë‹ˆí‹° + íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h1>

  <!-- ====================== -->
  <!-- 1. íšŒì›ê°€ì… / ë¡œê·¸ì¸    -->
  <!-- ====================== -->

  <h2>ğŸ” íšŒì›ê°€ì…</h2>
  <form id="signupForm">
    <div>
      <label>ì•„ì´ë””(userID):</label>
      <input type="text" name="userID" required />
    </div>
    <div>
      <label>ë¹„ë°€ë²ˆí˜¸:</label>
      <input type="password" name="password" required />
    </div>
    <div>
      <label>ì´ë¦„:</label>
      <input type="text" name="name" required />
    </div>
    <div>
      <label>ì´ë©”ì¼:</label>
      <input type="email" name="email" required />
    </div>
    <button type="submit">íšŒì›ê°€ì…</button>
  </form>

  <hr />

  <h2>ğŸ”‘ ë¡œê·¸ì¸</h2>
  <form id="loginForm">
    <div>
      <label>ì•„ì´ë””(userID):</label>
      <input type="text" name="userID" required />
    </div>
    <div>
      <label>ë¹„ë°€ë²ˆí˜¸:</label>
      <input type="password" name="password" required />
    </div>
    <button type="submit">ë¡œê·¸ì¸</button>
  </form>

  <p id="loginStatus">ë¡œê·¸ì¸ ìƒíƒœ: ì—†ìŒ</p>

  <hr />

  <!-- ====================== -->
  <!-- 2. íŒŒì¼ ì—…ë¡œë“œ / ëª©ë¡   -->
  <!-- ====================== -->

  <h2>ğŸ“¤ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë¡œ íŒŒì¼ ì—…ë¡œë“œ</h2>
  <form id="uploadForm">
    <div>
      <label>íŒŒì¼ ì„ íƒ:</label>
      <input type="file" name="file" required />
    </div>
    <button type="submit">ì—…ë¡œë“œ</button>
  </form>
  <p>ì—…ë¡œë“œ ê²°ê³¼: <span id="uploadResult"></span></p>

  <h2>ğŸ“‚ ë‚´ íŒŒì¼ ëª©ë¡ (ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ê¸°ì¤€)</h2>
  <button id="loadFilesBtn">ë‚´ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <ul id="fileList"></ul>

  <hr />

  <!-- ====================== -->
  <!-- 3. ê²Œì‹œê¸€ ëª©ë¡ / ì‘ì„±   -->
  <!-- ====================== -->

  <h2>ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡</h2>
  <div>
    <label>ì •ë ¬:</label>
    <select id="postSortSelect">
      <option value="time">ìµœì‹ ìˆœ</option>
      <option value="likes">ì¢‹ì•„ìš”ìˆœ</option>
    </select>
    <button id="loadPostsBtn">ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </div>
  <ul id="postList"></ul>

  <hr />

  <h2>âœ ìƒˆ ê²Œì‹œê¸€ ì‘ì„± (ë¡œê·¸ì¸ í•„ìš”)</h2>
  <form id="postForm">
    <div>
      <label>ì œëª©:</label>
      <input type="text" name="title" required />
    </div>
    <div>
      <label>ë‚´ìš©:</label><br />
      <textarea name="content" rows="4" cols="50" required></textarea>
    </div>
    <div>
      <label>ê´€ë ¨ íŒŒì¼ ID(ì˜µì…˜):</label>
      <input type="text" name="relatedFileId" placeholder="íŒŒì¼ê³¼ í† ë¡ ì„ ì—°ê²°í•˜ê³  ì‹¶ìœ¼ë©´ fileId ì…ë ¥" />
    </div>
    <button type="submit">ê²Œì‹œê¸€ ë“±ë¡</button>
  </form>

  <p id="postResult"></p>

  <hr />

  <!-- ====================== -->
  <!-- 4. ê²Œì‹œê¸€ ìƒì„¸ + ëŒ“ê¸€   -->
  <!-- ====================== -->

  <h2>ğŸ“Œ ì„ íƒí•œ ê²Œì‹œê¸€ ìƒì„¸ / ëŒ“ê¸€</h2>
  <div id="selectedPost">
    <p>ì•„ì§ ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  </div>

  <h3>ğŸ’¬ ëŒ“ê¸€ ëª©ë¡</h3>
  <div>
    <label>ëŒ“ê¸€ ì •ë ¬:</label>
    <select id="commentSortSelect">
      <option value="time">ì‘ì„± ìˆœ</option>
      <option value="likes">ì¢‹ì•„ìš”ìˆœ</option>
    </select>
    <button id="refreshCommentsBtn">ëŒ“ê¸€ ìƒˆë¡œê³ ì¹¨</button>
  </div>
  <ul id="commentList"></ul>

  <h3>â• ëŒ“ê¸€ ì‘ì„± (ë¡œê·¸ì¸ í•„ìš”)</h3>
  <p id="replyInfo">í˜„ì¬ ëª¨ë“œ: ì¼ë°˜ ëŒ“ê¸€</p>
  <form id="commentForm">
    <input type="hidden" name="parentCommentID" />
    <div>
      <textarea name="content" rows="3" cols="50" required></textarea>
    </div>
    <button type="submit">ëŒ“ê¸€ ë“±ë¡</button>
    <button type="button" id="cancelReplyBtn">ëŒ€ëŒ“ê¸€ ì·¨ì†Œ</button>
  </form>

  <p id="commentResult"></p>

  <script>
    const API_BASE = "http://localhost:4000";

    let jwtToken = null;
    let currentUserID = null;
    let currentPostID = null;
    let currentCommentSort = "time";

    // ============================
    // 1. íšŒì›ê°€ì… / ë¡œê·¸ì¸
    // ============================

    // íšŒì›ê°€ì…
    document.getElementById("signupForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const body = {
        userID: form.userID.value,
        password: form.password.value,
        name: form.name.value,
        email: form.email.value,
      };

      try {
        const res = await fetch(API_BASE + "/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        const data = await res.json();
        alert("íšŒì›ê°€ì…: " + data.message);
      } catch (err) {
        console.error(err);
        alert("íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜");
      }
    });

    // ë¡œê·¸ì¸
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const body = {
        userID: form.userID.value,
        password: form.password.value,
      };

      try {
        const res = await fetch(API_BASE + "/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        const data = await res.json();
        if (!res.ok) {
          alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + (data.message || "ì˜¤ë¥˜"));
          return;
        }

        jwtToken = data.token;
        currentUserID = body.userID;

        document.getElementById("loginStatus").textContent =
          "ë¡œê·¸ì¸ ìƒíƒœ: " + currentUserID;
        alert("ë¡œê·¸ì¸ ì„±ê³µ! í† í°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
      } catch (err) {
        console.error(err);
        alert("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜");
      }
    });

    // ============================
    // 2. íŒŒì¼ ì—…ë¡œë“œ / ë‚´ íŒŒì¼ ëª©ë¡
    // ============================

    // íŒŒì¼ ì—…ë¡œë“œ
    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!jwtToken) {
        alert("ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”!");
        return;
      }

      const form = e.target;
      const fileInput = form.file;
      if (!fileInput.files || fileInput.files.length === 0) {
        alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      try {
        const res = await fetch(API_BASE + "/upload", {
          method: "POST",
          headers: {
            Authorization: "Bearer " + jwtToken,
          },
          body: formData,
        });

        const data = await res.json();
        if (!res.ok) {
          alert("ì—…ë¡œë“œ ì‹¤íŒ¨: " + (data.message || "ì˜¤ë¥˜"));
          return;
        }

        document.getElementById("uploadResult").textContent =
          "fileId: " + data.fileId + ", filename: " + data.filename;

        // ì—…ë¡œë“œ í›„ ë‚´ íŒŒì¼ ëª©ë¡ ê°±ì‹ 
        loadMyFiles();
        form.reset();
      } catch (err) {
        console.error(err);
        alert("ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜");
      }
    });

    // ë‚´ íŒŒì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadMyFiles() {
      if (!jwtToken) {
        alert("ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”!");
        return;
      }

      try {
        const res = await fetch(API_BASE + "/files", {
          headers: {
            Authorization: "Bearer " + jwtToken,
          },
        });

        const data = await res.json();
        if (!res.ok) {
          alert("íŒŒì¼ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: " + (data.message || "ì˜¤ë¥˜"));
          return;
        }

        const listEl = document.getElementById("fileList");
        listEl.innerHTML = "";

        data.forEach((file) => {
          const li = document.createElement("li");
          const link = document.createElement("a");
          link.href = API_BASE + "/file/" + file.id;
          link.textContent =
            file.filename +
            " (" +
            new Date(file.uploadDate).toLocaleString() +
            ")";
          link.download = file.filename;
          li.appendChild(link);
          listEl.appendChild(li);
        });
      } catch (err) {
        console.error(err);
        alert("íŒŒì¼ ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜");
      }
    }

    document.getElementById("loadFilesBtn").addEventListener("click", loadMyFiles);

    // ============================
    // 3. ê²Œì‹œê¸€ ëª©ë¡ / ì‘ì„± / ì¢‹ì•„ìš”
    // ============================

    async function loadPosts() {
      try {
        const sortValue = document.getElementById("postSortSelect").value;
        const sortQuery = sortValue === "likes" ? "?sort=likes" : "";
        const res = await fetch(API_BASE + "/posts" + sortQuery);
        const data = await res.json();

        if (!res.ok) {
          alert("ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: " + (data.message || "ì˜¤ë¥˜"));
          return;
        }

        const listEl = document.getElementById("postList");
        listEl.innerHTML = "";

        data.forEach((post) => {
          const li = document.createElement("li");

          const titleLink = document.createElement("a");
          titleLink.href = "#";
          titleLink.textContent =
            "[" + post.postID + "] " + post.title + " - " + post.authorName +
            " (" + new Date(post.createdAt).toLocaleString() + ")";
          titleLink.addEventListener("click", (e) => {
            e.preventDefault();
            loadPostDetail(post.postID);
          });

          const infoSpan = document.createElement("span");
          infoSpan.textContent = "  |  ğŸ‘ " + post.likesCount;

          const likeBtn = document.createElement("button");
          likeBtn.textContent = "ì¢‹ì•„ìš”";
          likeBtn.addEventListener("click", async () => {
            if (!jwtToken) {
              alert("ì¢‹ì•„ìš”ëŠ” ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤!");
              return;
            }
            try {
              const resLike = await fetch(
                API_BASE + "/posts/" + post.postID + "/like",
                {
                  method: "POST",
                  headers: {
                    Authorization: "Bearer " + jwtToken,
                  },
                }
              );
              const likeData = await resLike.json();
              if (!resLike.ok) {
                alert("ì¢‹ì•„ìš” ìš”ì²­ ì‹¤íŒ¨: " + (likeData.message || "ì˜¤ë¥˜"));
                return;
              }
              // ëª©ë¡ì„ ë‹¤ì‹œ ë¡œë”©í•´ì„œ ìµœì‹  ì¢‹ì•„ìš” ìˆ˜ ë°˜ì˜
              await loadPosts();
              // í˜„ì¬ ê²Œì‹œê¸€ ìƒì„¸ë¥¼ ë³´ê³  ìˆìœ¼ë©´, ìƒì„¸ë„ ìƒˆë¡œê³ ì¹¨
              if (currentPostID === post.postID) {
                await loadPostDetail(post.postID);
              }
            } catch (err) {
              console.error(err);
              alert("ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜");
            }
          });

          li.appendChild(titleLink);
          li.appendChild(infoSpan);
          li.appendChild(document.createTextNode(" "));
          li.appendChild(likeBtn);

          listEl.appendChild(li);
        });
      } catch (err) {
        console.error(err);
        alert("ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜");
      }
    }

    document.getElementById("loadPostsBtn").addEventListener("click", loadPosts);

    // ìƒˆ ê²Œì‹œê¸€ ì‘ì„±
    document.getElementById("postForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!jwtToken) {
        alert("ê²Œì‹œê¸€ ì‘ì„±ì€ ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤!");
        return;
      }

      const form = e.target;
      const body = {
        title: form.title.value,
        content: form.content.value,
        relatedFileId: form.relatedFileId.value || null,
      };

      try {
        const res = await fetch(API_BASE + "/posts", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + jwtToken,
          },
          body: JSON.stringify(body),
        });

        const data = await res.json();
        if (!res.ok) {
          alert("ê²Œì‹œê¸€ ì‘ì„± ì‹¤íŒ¨: " + (data.message || "ì˜¤ë¥˜"));
          return;
        }

        document.getElementById("postResult").textContent =
          "ê²Œì‹œê¸€ ì‘ì„± ì„±ê³µ! postID: " + data.post.postID;

        form.reset();
        await loadPosts();
      } catch (err) {
        console.error(err);
        alert("ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜");
      }
    });

    // ============================
    // 4. ê²Œì‹œê¸€ ìƒì„¸ / ëŒ“ê¸€ / ëŒ€ëŒ“ê¸€ / ì¢‹ì•„ìš” / ì •ë ¬
    // ============================

    // ê²Œì‹œê¸€ ìƒì„¸ + ëŒ“ê¸€ ë¡œë”©
    async function loadPostDetail(postID) {
      currentPostID = postID;

      try {
        // 1) ê²Œì‹œê¸€ ìƒì„¸
        const resPost = await fetch(API_BASE + "/posts/" + postID);
        const post = await resPost.json();
        if (!resPost.ok) {
          alert("ê²Œì‹œê¸€ ì¡°íšŒ ì‹¤íŒ¨: " + (post.message || "ì˜¤ë¥˜"));
          return;
        }

        const postDiv = document.getElementById("selectedPost");
        postDiv.innerHTML = `
          <h3>[${post.postID}] ${post.title}</h3>
          <p>ì‘ì„±ì: ${post.authorName} (${post.userID})</p>
          <p>ì‘ì„±ì¼: ${new Date(post.createdAt).toLocaleString()}</p>
          ${
            post.relatedFileId
              ? `<p>ê´€ë ¨ íŒŒì¼ ID: ${post.relatedFileId}</p>`
              : ""
          }
          <pre style="white-space: pre-wrap;">${post.content}</pre>
        `;

        // 2) ëŒ“ê¸€ ë¡œë”©
        await loadComments();
      } catch (err) {
        console.error(err);
        alert("ê²Œì‹œê¸€ ìƒì„¸/ëŒ“ê¸€ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜");
      }
    }

    // ëŒ“ê¸€ ëª©ë¡ ë¡œë”© (í˜„ì¬ ì •ë ¬ ê¸°ì¤€ ì ìš©)
    async function loadComments() {
      if (!currentPostID) return;

      try {
        const sortValue = currentCommentSort;
        const sortQuery = sortValue === "likes" ? "?sort=likes" : "";
        const res = await fetch(
          API_BASE + "/posts/" + currentPostID + "/comments" + sortQuery
        );
        const comments = await res.json();

        if (!res.ok) {
          alert("ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: " + (comments.message || "ì˜¤ë¥˜"));
          return;
        }

        const listEl = document.getElementById("commentList");
        listEl.innerHTML = "";

        // ëŒ“ê¸€ íŠ¸ë¦¬ êµ¬ì„± (parentCommentID ê¸°ì¤€)
        const tree = buildCommentTree(comments);
        tree.forEach((comment) => {
          renderCommentItem(comment, listEl, 0);
        });

        document.getElementById("commentResult").textContent = "";
      } catch (err) {
        console.error(err);
        alert("ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜");
      }
    }

    // í‰íƒ„í•œ ëŒ“ê¸€ ë°°ì—´ â†’ íŠ¸ë¦¬ í˜•íƒœë¡œ ë³€í™˜
    function buildCommentTree(comments) {
      const map = {};
      comments.forEach((c) => {
        map[c.commentID] = { ...c, children: [] };
      });

      const roots = [];
      comments.forEach((c) => {
        const node = map[c.commentID];
        if (c.parentCommentID) {
          const parent = map[c.parentCommentID];
          if (parent) {
            parent.children.push(node);
          } else {
            // ë¶€ëª¨ë¥¼ ëª» ì°¾ìœ¼ë©´ ë£¨íŠ¸ë¡œ ì·¨ê¸‰
            roots.push(node);
          }
        } else {
          roots.push(node);
        }
      });

      return roots;
    }

    // ëŒ“ê¸€ í•˜ë‚˜ ë Œë”ë§ (ì¬ê·€ì ìœ¼ë¡œ children í¬í•¨)
    function renderCommentItem(comment, container, level) {
      const li = document.createElement("li");
      li.className = "comment-item";

      const indentClass =
        level === 0 ? "" : level === 1 ? "indent-1" : level === 2 ? "indent-2" : "indent-3";
      if (indentClass) li.classList.add(indentClass);

      const infoSpan = document.createElement("span");
      infoSpan.textContent =
        `[${comment.commentID}] ${comment.authorName}: ${comment.content} ` +
        `(${new Date(comment.createdAt).toLocaleString()}) ` +
        ` | ğŸ‘ ${comment.likesCount || 0}`;
      li.appendChild(infoSpan);

      const actionsDiv = document.createElement("div");
      actionsDiv.className = "comment-actions";

      const likeBtn = document.createElement("button");
      likeBtn.textContent = "ì¢‹ì•„ìš”";
      likeBtn.addEventListener("click", () => handleCommentLike(comment.commentID));

      const replyBtn = document.createElement("button");
      replyBtn.textContent = "ë‹µê¸€";
      replyBtn.addEventListener("click", () => setReplyTarget(comment.commentID));

      actionsDiv.appendChild(likeBtn);
      actionsDiv.appendChild(replyBtn);
      li.appendChild(actionsDiv);

      container.appendChild(li);

      if (comment.children && comment.children.length > 0) {
        comment.children.forEach((child) => {
          renderCommentItem(child, container, level + 1);
        });
      }
    }

    // ëŒ“ê¸€ ì¢‹ì•„ìš” ì²˜ë¦¬
    async function handleCommentLike(commentID) {
      if (!jwtToken) {
        alert("ëŒ“ê¸€ ì¢‹ì•„ìš”ëŠ” ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤!");
        return;
      }
      if (!currentPostID) return;

      try {
        const res = await fetch(
          API_BASE + "/posts/" + currentPostID + "/comments/" + commentID + "/like",
          {
            method: "POST",
            headers: {
              Authorization: "Bearer " + jwtToken,
            },
          }
        );
        const data = await res.json();
        if (!res.ok) {
          alert("ëŒ“ê¸€ ì¢‹ì•„ìš” ì²˜ë¦¬ ì‹¤íŒ¨: " + (data.message || "ì˜¤ë¥˜"));
          return;
        }
        await loadComments();
      } catch (err) {
        console.error(err);
        alert("ëŒ“ê¸€ ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜");
      }
    }

    // ëŒ€ëŒ“ê¸€ íƒ€ê²Ÿ ì„¤ì •
    function setReplyTarget(commentID) {
      const form = document.getElementById("commentForm");
      form.parentCommentID.value = commentID;
      document.getElementById("replyInfo").textContent =
        "í˜„ì¬ ëª¨ë“œ: ëŒ“ê¸€ #" + commentID + " ì— ëŒ€í•œ ëŒ€ëŒ“ê¸€ ì‘ì„± ì¤‘";
    }

    // ëŒ€ëŒ“ê¸€ ì·¨ì†Œ
    document.getElementById("cancelReplyBtn").addEventListener("click", () => {
      resetReplyTarget();
    });

    function resetReplyTarget() {
      const form = document.getElementById("commentForm");
      form.parentCommentID.value = "";
      document.getElementById("replyInfo").textContent =
        "í˜„ì¬ ëª¨ë“œ: ì¼ë°˜ ëŒ“ê¸€";
    }

    // ëŒ“ê¸€ ì‘ì„±
    document.getElementById("commentForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!jwtToken) {
        alert("ëŒ“ê¸€ ì‘ì„±ì€ ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤!");
        return;
      }
      if (!currentPostID) {
        alert("ë¨¼ì € ê²Œì‹œê¸€ì„ ì„ íƒí•˜ì„¸ìš”!");
        return;
      }

      const form = e.target;
      const body = {
        content: form.content.value,
      };
      if (form.parentCommentID.value) {
        body.parentCommentID = Number(form.parentCommentID.value);
      }

      try {
        const res = await fetch(
          API_BASE + "/posts/" + currentPostID + "/comments",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: "Bearer " + jwtToken,
            },
            body: JSON.stringify(body),
          }
        );

        const data = await res.json();
        if (!res.ok) {
          alert("ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨: " + (data.message || "ì˜¤ë¥˜"));
          return;
        }

        document.getElementById("commentResult").textContent =
          "ëŒ“ê¸€ ì‘ì„± ì„±ê³µ! commentID: " + data.comment.commentID;

        form.reset();
        resetReplyTarget();
        await loadComments();
      } catch (err) {
        console.error(err);
        alert("ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜");
      }
    });

    // ëŒ“ê¸€ ì •ë ¬ ë³€ê²½
    document.getElementById("commentSortSelect").addEventListener("change", () => {
      currentCommentSort = document.getElementById("commentSortSelect").value;
      loadComments();
    });

    document.getElementById("refreshCommentsBtn").addEventListener("click", () => {
      loadComments();
    });
  </script>
</body>
</html>
